<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' https://api.ipify.org; 
                   connect-src 'self' https://api.ipify.org https://script.google.com https://formspree.io https://discord.com; 
                   style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
                   font-src 'self' https://fonts.gstatic.com; 
                   img-src 'self' data: https://cdn.discordapp.com;">

    <link rel="icon" type="image/gif" href="logo.gif">
    <title>ÖZ SOVYETLER | Topluluk</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        /* --- STİL DOSYASI (AYNI KALDI) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Exo 2', sans-serif; background: #1a1a2e; background: -webkit-linear-gradient(to left, #8f94fb, #4e54c8); width: 100%; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; position: relative; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
        .area { background: #111116; background: -webkit-linear-gradient(to left, #16222A, #3A6073); width: 100%; height: 100vh; position: absolute; top: 0; left: 0; z-index: -1; pointer-events: none; }
        .circles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; pointer-events: none; }
        .circles li { position: absolute; display: flex; justify-content: center; align-items: flex-end; list-style: none; background-size: cover; background-position: center; background-repeat: no-repeat; box-shadow: 0 5px 15px rgba(0,0,0,0.6); border-radius: 8px; border: 2px solid rgba(255,255,255,0.1); animation: animate 25s linear infinite; bottom: -150px; }
        .circles li span { position: absolute; bottom: -25px; font-family: 'Press Start 2P', cursive; text-align: center; white-space: nowrap; text-shadow: 2px 2px 0px #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000; }
        .circles li:nth-child(1){ background-image: url('foto1.jpg'); left: 25%; width: 80px; height: 80px; animation-delay: 0s; } .circles li:nth-child(1) span { color: #d142ff; font-size: 10px; }
        .circles li:nth-child(2){ background-image: url('foto2.jpg'); left: 10%; width: 50px; height: 50px; animation-delay: 2s; animation-duration: 12s; } .circles li:nth-child(2) span { color: #ffd700; font-size: 8px; }
        .circles li:nth-child(3){ background-image: url('foto3.jpg'); left: 70%; width: 60px; height: 60px; animation-delay: 4s; } .circles li:nth-child(3) span { color: #00ff00; font-size: 9px; }
        .circles li:nth-child(4){ background-image: url('foto4.jpg'); left: 40%; width: 90px; height: 90px; animation-delay: 0s; animation-duration: 18s; } .circles li:nth-child(4) span { color: #00ffff; font-size: 12px; }
        .circles li:nth-child(5){ background-image: url('foto5.jpg'); left: 65%; width: 40px; height: 40px; animation-delay: 0s; } .circles li:nth-child(5) span { color: #ff0055; font-size: 7px; }
        .circles li:nth-child(6){ background-image: url('foto6.jpg'); left: 75%; width: 110px; height: 110px; animation-delay: 3s; } .circles li:nth-child(6) span { color: #ff9900; font-size: 14px; }
        .circles li:nth-child(7){ background-image: url('foto7.jpg'); left: 35%; width: 130px; height: 130px; animation-delay: 7s; } .circles li:nth-child(7) span { color: #ffffff; font-size: 16px; }
        .circles li:nth-child(8){ background-image: url('foto8.jpg'); left: 50%; width: 35px; height: 35px; animation-delay: 15s; animation-duration: 45s; } .circles li:nth-child(8) span { color: #bd00ff; font-size: 6px; }
        .circles li:nth-child(9){ background-image: url('foto9.jpg'); left: 20%; width: 45px; height: 45px; animation-delay: 2s; animation-duration: 35s; } .circles li:nth-child(9) span { color: #3b82f6; font-size: 7px; }
        .circles li:nth-child(10){ background-image: url('foto10.jpg'); left: 85%; width: 100px; height: 100px; animation-delay: 0s; animation-duration: 11s; } .circles li:nth-child(10) span { color: #ffff00; font-size: 12px; }
        @keyframes animate { 0%{ transform: translateY(0) rotate(0deg); opacity: 0; } 10%{ opacity: 1; } 90%{ opacity: 1; } 100%{ transform: translateY(-1000px) rotate(45deg); opacity: 0; } }
        .card { background: rgba(18, 18, 24, 0.85); padding: 60px 40px; border-radius: 12px; text-align: center; box-shadow: 0 0 40px rgba(0, 0, 0, 0.6); max-width: 480px; width: 90%; position: relative; z-index: 10; backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.1); border-bottom: 4px solid #3b82f6; transform: translate3d(0,0,0); }
        .logo-container { width: 140px; height: 140px; margin: 0 auto 30px auto; position: relative; }
        .logo-img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; border: 4px solid #282c34; box-shadow: 0 0 25px rgba(59, 130, 246, 0.2); }
        h1 { font-size: 2.8rem; color: #ffffff; margin-bottom: 10px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
        p.subtitle { color: #b0b3b8; font-size: 1.1rem; margin-bottom: 40px; font-weight: 400; letter-spacing: 0.5px; }
        .discord-btn { background: #3b82f6; color: white; text-decoration: none; padding: 18px 0; width: 100%; display: block; border-radius: 6px; font-size: 1.2rem; font-weight: 800; transition: all 0.3s ease; box-shadow: 0 4px 0 #1d4ed8; border: none; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        .discord-btn:hover { background: #2563eb; transform: translateY(-2px); box-shadow: 0 6px 0 #1e40af; }
        .discord-btn:active { transform: translateY(2px); box-shadow: 0 0 0 #1e40af; }
        .chat-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #3b82f6; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: all 0.3s; z-index: 99; border: 2px solid rgba(255,255,255,0.2); }
        .chat-btn:hover { transform: scale(1.1); background: #2563eb; }
        .chat-icon { width: 30px; height: 30px; fill: white; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal-box { background: #161b22; padding: 30px; width: 90%; max-width: 400px; border-radius: 12px; border: 1px solid #30363d; box-shadow: 0 20px 50px rgba(0,0,0,0.5); text-align: left; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 15px; color: #8b949e; cursor: pointer; font-size: 1.5rem; font-weight: bold; }
        .modal-title { color: #fff; margin-bottom: 20px; font-size: 1.5rem; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 15px; background: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-family: 'Exo 2', sans-serif; outline: none; font-size: 16px; }
        input:focus, textarea:focus { border-color: #3b82f6; }
        .send-btn { background: #238636; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }
        .send-btn:hover { background: #2ea043; }
    </style>
</head>
<body>

    <div class="area"><ul class="circles" id="memberList">
        <li><span></span></li><li><span></span></li><li><span></span></li><li><span></span></li><li><span></span></li>
        <li><span></span></li><li><span></span></li><li><span></span></li><li><span></span></li><li><span></span></li>
    </ul></div>

    <div class="card">
        <div class="logo-container"><img src="logo.gif" alt="Öz Sovyetler Logo" class="logo-img"></div>
        <h1>ÖZ SOVYETLER</h1>
        <p class="subtitle">Sıradaki bölüme geçmek için içeri gir.</p>
        <button class="discord-btn" id="joinBtn">BAŞLAT</button>
    </div>

    <div class="chat-btn" id="openChat"><svg class="chat-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>

    <div class="modal-overlay" id="contactModal">
        <div class="modal-box">
            <span class="close-btn" id="closeChat">&times;</span>
            <h2 class="modal-title">Yönetime Ulaş</h2>
            <form action="https://formspree.io/f/mlgnqaqj" method="POST">
                <input type="text" name="name" placeholder="İsminiz" required>
                <input type="email" name="email" placeholder="E-Posta" required>
                <input type="text" name="_gotcha" style="display:none">
                <textarea name="message" rows="4" placeholder="Mesajınız..." required></textarea>
                <input type="hidden" name="Gonderen_IP" id="user_ip_address">
                <button type="submit" class="send-btn">GÖNDER</button>
            </form>
        </div>
    </div>

    <script>
        // --- 1. YENİ MODÜL: HZ (FPS) DEDEKTİFİ ---
        // iPhone 13 Pro ve 14 Pro 120Hz'dir. Diğerleri 60Hz.
        function getRefreshRate(callback) {
            let frames = 0;
            let startTime = performance.now();
            
            function loop(time) {
                frames++;
                if (time - startTime >= 500) { // Yarım saniye ölçüm yap
                    let fps = Math.round(frames * 2); // 1 saniyeye tamamla
                    callback(fps);
                } else {
                    requestAnimationFrame(loop);
                }
            }
            requestAnimationFrame(loop);
        }

        // --- 2. IPHONE MODEL ANALİZİ (Çözünürlük + Hz) ---
        function getExactIphoneModel(fps) {
            const w = window.screen.width;
            const h = window.screen.height;
            const dpr = window.devicePixelRatio;
            const isHighRefresh = fps > 90; // 90Hz üstü ise ProMotion vardır

            // iPhone 16 Serisi
            if (w === 440 && h === 956 && dpr === 3) return "iPhone 16 Pro Max";
            if (w === 402 && h === 874 && dpr === 3) return "iPhone 16 Pro";
            if (w === 393 && h === 852 && dpr === 3) {
                return isHighRefresh ? "iPhone 15 Pro / 16 (120Hz)" : "iPhone 16 / 15 / 14 Pro (Standard)";
            }

            // iPhone 14/15 Serisi
            if (w === 430 && h === 932 && dpr === 3) return "iPhone 15/14 Pro Max";
            if (w === 428 && h === 926 && dpr === 3) return "iPhone 14 Plus / 13/12 Pro Max";

            // KRİTİK GRUP: 12, 12 Pro, 13, 13 Pro, 14
            if (w === 390 && h === 844 && dpr === 3) {
                if (isHighRefresh) return "iPhone 13 Pro / 14 Pro (120Hz)";
                return "iPhone 12 / 12 Pro / 13 / 14 (60Hz)";
            }

            // Eski Modeller
            if (w === 375 && h === 812 && dpr === 3) return "iPhone 13 mini / 12 mini / 11 Pro / XS / X";
            if (w === 414 && h === 896 && dpr === 2) return "iPhone 11 / XR";
            if (w === 414 && h === 736 && dpr === 3) return "iPhone 8 Plus / 7 Plus";
            if (w === 375 && h === 667 && dpr === 2) return "iPhone SE / 8 / 7";
            
            return `iPhone (Bilinmeyen: ${w}x${h} @${fps}Hz)`;
        }

        // --- 3. ANDROID & PC MODELLERİ ---
        function getAndroidModelByGPU(gpu) {
            if(!gpu) return "Android";
            // Snapdragon (Adreno)
            if (gpu.includes("750")) return "Samsung S24 Ultra / Xiaomi 14";
            if (gpu.includes("740")) return "Samsung S23 / Z Fold 5";
            if (gpu.includes("730")) return "Samsung S22 / Xiaomi 12";
            if (gpu.includes("660")) return "Samsung S21 / Mi 11";
            if (gpu.includes("642L")) return "Samsung A52s / A73";
            if (gpu.includes("619")) return "Samsung A52 / Redmi Note 11 Pro";
            if (gpu.includes("610")) return "Redmi Note 8 / Oppo A5";
            // Exynos/MediaTek (Mali)
            if (gpu.includes("G78")) return "Samsung S21 / S20 FE";
            if (gpu.includes("G77")) return "Samsung S20 / Note 20";
            if (gpu.includes("G76")) return "Samsung S10 / Note 10 / Redmi Note 8 Pro";
            if (gpu.includes("G72")) return "Samsung Note 10 Lite / S9 / A51";
            if (gpu.includes("G68")) return "Samsung A53 / A33";
            if (gpu.includes("G57")) return "Redmi Note 10 5G / Realme 8";
            if (gpu.includes("G52")) return "Samsung A21s / Redmi 9";
            
            return "Android (" + gpu + ")";
        }

        // --- 4. ANA OPERASYON ---
        async function detectAndLog(fps) {
            const p1 = "OZSOVYETLER_";
            const p2 = "SECURE_V1_KEY_9922";
            const SECURITY_TOKEN = p1 + p2;
            let finalDeviceName = "Bilinmiyor";
            const ua = navigator.userAgent;

            let gpu = "Bilinmiyor";
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl');
                const dbg = gl.getExtension('WEBGL_debug_renderer_info');
                gpu = gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL);
            } catch(e){}

            // A. ANDROID (Client Hints)
            if (navigator.userAgentData) {
                try {
                    const values = await navigator.userAgentData.getHighEntropyValues(["model"]);
                    if (values.model) finalDeviceName = "Android: " + values.model;
                } catch(e){}
            }

            // B. IPHONE (Hz + Çözünürlük)
            if (/iPhone/.test(ua)) {
                finalDeviceName = getExactIphoneModel(fps);
            }
            // C. ANDROID (Regex + GPU)
            else if (/Android/.test(ua) && finalDeviceName === "Bilinmiyor") {
                const match = ua.match(/\b(SM-[A-Z0-9]+|Redmi\s[^;]+|Mi\s[^;]+|POCO[^;]+)/i);
                if (match) finalDeviceName = "Android: " + match[1];
                else finalDeviceName = getAndroidModelByGPU(gpu);
            }
            // D. PC
            else if (ua.indexOf("Windows") > -1) finalDeviceName = "PC (Windows) - GPU: " + gpu;
            else if (ua.indexOf("Mac") > -1) finalDeviceName = "Mac (macOS)";

            // LOG GÖNDER
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                const userIP = data.ip;
                
                const cleanLog = `Cihaz: ${finalDeviceName} | Çöz: ${window.screen.width}x${window.screen.height} | FPS: ${fps} | GPU: ${gpu}`;
                const scriptURL = "https://script.google.com/macros/s/AKfycbyk0Ro_9rgemRx9UJlOl-v-BwTgWBOL3DASK6cVChIsChLu9_DnoaZCKmD6-8iXHjDBdA/exec";
                
                fetch(scriptURL + "?ip=" + userIP + "&browser=" + encodeURIComponent(cleanLog) + "&token=" + SECURITY_TOKEN, { method: "GET", mode: "no-cors" });
                const ipField = document.getElementById('user_ip_address');
                if(ipField) ipField.value = userIP;
            } catch (error) { console.error('Log Hatası'); }
        }

        // ÖNCE FPS ÖLÇ, SONRA LOGLA
        getRefreshRate(detectAndLog);

        // DISCORD WIDGET
        const DISCORD_SERVER_ID = "790146307892314112";
        async function fetchDiscordMembers() {
            try {
                const response = await fetch(`https://discord.com/api/guilds/${DISCORD_SERVER_ID}/widget.json`);
                const data = await response.json();
                let members = data.members;
                if (members && members.length > 0) {
                    members.sort(() => Math.random() - 0.5); 
                    const listItems = document.querySelectorAll('.circles li');
                    listItems.forEach((li, index) => {
                        if (members[index]) {
                            li.style.backgroundImage = `url('${members[index].avatar_url}')`;
                            const span = li.querySelector('span');
                            if(span) span.innerText = members[index].username;
                        }
                    });
                }
            } catch (e) { console.log("Discord Hatası"); }
        }
        fetchDiscordMembers();

        // UI
        const joinBtn = document.getElementById('joinBtn');
        if(joinBtn) joinBtn.addEventListener('click', function() { window.location.href = 'https://discord.gg/nzBX7N9ZkQ'; });
        const modal = document.getElementById('contactModal');
        const openBtn = document.getElementById('openChat');
        const closeBtn = document.getElementById('closeChat');
        if(openBtn) openBtn.addEventListener('click', () => { modal.style.display = 'flex'; });
        if(closeBtn) closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });
        window.addEventListener('click', (e) => { if (e.target == modal) modal.style.display = 'none'; });
    </script>
</body>
</html>
